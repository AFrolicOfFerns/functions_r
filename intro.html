<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to R Functions</title>
    <meta charset="utf-8" />
    <meta name="author" content="Stephanie Kirmer  www.stephaniekirmer.com  @data_stephanie" />
    <meta name="date" content="2021-02-26" />
    <script src="intro_files/header-attrs-2.6/header-attrs.js"></script>
    <link href="intro_files/countdown-0.3.5/countdown.css" rel="stylesheet" />
    <script src="intro_files/countdown-0.3.5/countdown.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introduction to R Functions
## R Ladies Chicago and R Ladies East Lansing
### Stephanie Kirmer <BR> <a href="http://www.stephaniekirmer.com">www.stephaniekirmer.com</a> <BR> @<a href="http://www.twitter.com/data_stephanie">data_stephanie</a>
### February 26, 2021

---





# Overview

-   Lecture alternating with breakouts for hands-on examples   
--

-   Repo: https://github.com/skirmer/functions_r   
--

-   Support Team for questions/leading breakouts   
--

???
Introductions for support team
***

## Breakout Sections
  - Work through examples in small groups
  - 5-ish minute chunks
  - Choose either Beginner or Advanced group
    - Beginners will read provided function, and gradually edit it
    - Advanced will write your own function, and fully develop it

???
If you have your own code, or some idea for a function, you can work with Advanced group to develop it into a full function   
If you don't have your own code or don't want to write it all yourself, work with Beginner   
You can change groups later!   

---
# What is a Function Anyway?

![](function_diagram.png)

???
You have one thing, and you want to have another thing, so the function is your path to get there.

---
# Why Functions?

-   Avoid repetition
-   Share code with others
-   Eventually build packages

???
Those operations you want to run in order to get from what you have to what you need are useful to others!   
This framework is common to many programming languages

---
# Basic Structure


```r
myFunction &lt;- function(){
  ...
  return()
}

myFunction()
```

???
This shell is what lets R know that you intend to create a function.   
Now we need to add in the contents.

---
# Basic Structure


```r
myFunction &lt;- function(ARGUMENTS){
*  ...
  return(OUTPUT)
}

myFunction(ARGUMENTS)
```

---
# Basic Structure


```r
myFunction &lt;- function(a, b){
*  c &lt;- a*b
  return(c)
}

myFunction(a = 2,b = 4)
```


---
class: inverse

# Practice Break 1
Open possible_dog_part1.R and follow the instructions.

- Beginner: Read the sample function, and interpret what it does.
  - Discuss the structure. Think about what might make it better or easier to use. 
- Advanced: Take a bit of your own code and place it in a function structure. Change function name to something appropriate.

<div class="countdown" id="timer_60386f0d" style="bottom:0;left:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# Types
- Logical or Boolean (TRUE, FALSE, 0, 1)
- Integer (Numeric) (3, 7, 108)
- Double or Float (Numeric) (1.6645, 3.14159, 987.99)
- Character or String ("Hello", "a")
- Closure (function) (`sum()`)

More info in help: `?type` or `?mode`

Plus: list, complex, special, etc

???
Before we deep dive into these pieces, we have to make sure we understand types just a little.   
While we aren't going to go deep in today, your arguments can be things like lists and dataframes as well as single items - you can get creative!

---
# Arguments, or What Goes In

- Order and naming are important
- Defaults can be set, not required


```r
*myFunction &lt;- function(a=1, b=1){
  ...
myFunction(a = 2,b = 4)
```

???
You can set default values for the arguments as shown   
Your arguments need to observe a specific type usually (best practices)

---
class: inverse

# Practice Break 2
Open possible_dog_part2.R and follow the instructions.

- Beginner: Identify the changes in the example function. Try running it, and change the arguments. 
  - Discuss what change you made and what the effects were. What type/s can the function accept? What happens if you pass something else?
- Advanced: Add an argument to your function, and make it change the output. 

<div class="countdown" id="timer_60386f2f" style="bottom:0;left:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

???
If you weren't comfortable or were not challenged in the group you picked last time, you can switch!
---

# Returns, or What Comes Out

- Object (single) that you'll be able to use elsewhere
- May be any of the types we previously discussed
- Not required! Functions can do things besides return


```r
myFunction &lt;- function(a, b){
...
*  return(c)
}
```

???
Key - make sure the user of this function gets something they are reasonably expecting   
A function could change the state of an existing object without using a return (global env, will discuss)   
Single object return only in R

---
class: inverse

# Practice Break 3
Open possible_dog_part3.R and follow the instructions.

- Beginner: Identify the changes in the example function. What is it returning?
  - Try changing the return, see what it does.
- Advanced: Add a two-element return to your function. Remember that R does not allow multi-argument returns.

<div class="countdown" id="timer_60386dbf" style="bottom:0;left:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Guardrails: Documentation

- Explain what the arguments and returns are
- Demonstrate how the function is meant to be used
- May include `@description` or other additional items 


```r
#' Explain what my function does
#'
#' @param a Type. Description of what it represents.
#' @param b Type. Description of what it represents.
#'
#' @return Type. Description of what it represents.
#'
#' @examples
#' \dontrun{myFunction(a = 5, b = 3)}
```

???
Be clear, but not too wordy   
Tell the user what they need to know in order to use the function and understand

---
class: inverse

# Practice Break 4
Open possible_dog_part4.R and follow the instructions.

- Beginner: Fill in the blanks in the provided function documentation.
- Advanced: Add documentation for your function, including arguments and returns.

<div class="countdown" id="timer_60386f05" style="bottom:0;left:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# Guardrails: Type Check

- Setting an informative error helps the user
- Checks can look at be more than just type


```r
myFunction &lt;- function(a, b){
*  if(!is.double(a)) stop("a must be a number")
  c &lt;- a*b
  return(c)
}

myFunction(a = 2,b = 4)
#myFunction(a = TRUE, b = 4)
```

???
User might be future you! 

---

class: inverse

# Practice Break 5
Open possible_dog_part5.R and follow the instructions.

- Beginner: Examine the type check included in the function. Pass arguments to the function that will violate it.
  - Is the error informative? 
- Advanced: Add a type check to your function's arguments. Make sure the error message is clear.

<div class="countdown" id="timer_60386ddd" style="bottom:0;left:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Guardrails: Tests

- Vital for making packages later
- Helps you ensure that changes have not broken expected behavior


```r
library(testthat)
myFunction &lt;- function(a, b){
  if(!is.numeric(a)) stop("a must be a number")
  c &lt;- a*b
  return(c)
}
```



```r
test_that("Function returns correct value",
          {
            product = myFunction(a = 2,b = 4)
            expect_equal(product, 8)
          })
```

???
If the return is not in line with expectations, you can easily find out. 

---
# Guardrails: Tests


```r
library(testthat)

test_that("Function returns expected error",
          {
*            expect_error(myFunction(a = TRUE, b = 4))
          })
```


???

Tests can check that it fails or errors when it's supposed to as well!

---

class: inverse

# Practice Break 6
Open possible_dog_part6.R and follow the instructions.

- Beginner: Fill in the argument value that will make the test pass, or change the test.
  - Discuss whether it is more sensible to change the argument or the test. 
- Advanced: Write a test for your function.
  - Do you want to test for expected error or for expected return?

<div class="countdown" id="timer_60386fea" style="bottom:0;left:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---


# Environments

The function knows what exists inside itself, and what exists in the "global" environment.
Outside the function only knows what exists in the "global".
Here, a, b, and c do not exist in the world outside our function.


```r
print(environment())
print(objects())
myFunction &lt;- function(a, b){
*  c &lt;- a*b
  print(environment())
  print(objects())
  return(c)
}

myFunction(a = 2,b = 4)
```
---
# Global Environment

- No a, b, or c


```r
print(environment())
```

```
## &lt;environment: R_GlobalEnv&gt;
```

```r
print(objects())
```

```
## [1] "myFunction"
```

---
# Function Environment

- Here they are!


```r
myFunction &lt;- function(a, b){
*  c &lt;- a*b
  print(environment())
  print(objects())
  return(c)
}

myFunction(a = 2,b = 4)
```

```
## &lt;environment: 0x7f8cb246a160&gt;
## [1] "a" "b" "c"
```

```
## [1] 8
```
---
# Mixing Environments


```r
myFunction &lt;- function(a, b){
*  d &lt;&lt;- a*b
  print(environment())
  print(objects())
  return(c)
}
myFunction(a = 2,b = 4)
```

```
## &lt;environment: 0x7f8c843c1e80&gt;
## [1] "a" "b"
```

```
## function (...)  .Primitive("c")
```

```r
print(environment())
```

```
## &lt;environment: R_GlobalEnv&gt;
```

```r
print(objects())
```

```
## [1] "d"          "myFunction"
```

???
Watch out how you use the double arrow!

---
# Exploring a Function

- Just omit the parentheses

```r
dplyr::top_n
```

```
## function (x, n, wt) 
## {
##     lifecycle::signal_superseded("1.0.0", "top_n()", "slice_max()")
##     wt &lt;- enquo(wt)
##     if (quo_is_missing(wt)) {
##         vars &lt;- tbl_vars(x)
##         wt_name &lt;- vars[length(vars)]
##         inform(glue("Selecting by ", wt_name))
##         wt &lt;- sym(wt_name)
##     }
##     filter(x, top_n_rank({
##         {
##             n
##         }
##     }, !!wt))
## }
## &lt;bytecode: 0x7f8c842f3160&gt;
## &lt;environment: namespace:dplyr&gt;
```

---
# Combining Functions
- A function can be an argument to another function
- This way you can chain together elements powerfully
- Helps readability to use functions!


```r
a &lt;- sum(1, 5, 3)
b &lt;- max(a, 4)
b
```

```
## [1] 9
```

```r
c &lt;- max(sum(1, 5, 3), 4)
c
```

```
## [1] 9
```


---
# Conclusion

- Functions are a way of packaging small sections of code to reuse later
- Functions accept input and return output, and contain code
- Documentation and internal tests make functions more useful and easier to work with

---
# Further Reading
* http://adv-r.had.co.nz/Functions.html
* https://r4ds.had.co.nz/functions.html
* https://nicercode.github.io/guides/functions/
* https://cran.r-project.org/doc/manuals/r-release/R-intro.html#Writing-your-own-functions
* https://r-pkgs.org/man.html
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
